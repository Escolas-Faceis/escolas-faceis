<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Perfil Escola Canarinho </title>
    <link rel="stylesheet" href="css/vizu-perfil-usu.css">
    <link rel="stylesheet" href="css/perfil.css">
    <link rel="stylesheet" href="css/aval.css">
    <link rel="stylesheet" href="css/vizu.css">
    <!-- <link rel="stylesheet" href="css/carrossel-perfil.css"> -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-notify@0.5.5/dist/simple-notify.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/simple-notify@0.5.5/dist/simple-notify.min.js"></script>
</head>
<script>
        function notify(title, text, type, position, timeout = 5000) {
            new Notify({
                status: type,
                title: title,
                text: text,
                effect: 'fade',
                speed: 500,
                showIcon: true,
                showCloseButton: true,
                autoclose: true,
                autotimeout: timeout,
                gap: 20,
                distance: 20,
                type: 1,
                position: position
            });
        }
    </script>

    <%
        const tiposclassseCss = {
            'Educação Infantil': 'EI',
            'Ensino Fundamental I': 'EFI',
            'Ensino Fundamental II': 'EFII',
            'Ensino Fundamental': 'EFI',
            'Ensino Médio': 'EM',
            'Educação Integrada': 'EINT',
            'Cursos Técnicos': 'TEC',
            'Cursos Extracurriculares': 'CSO'
        }
        
    %>




<body>
     <%
    let  msgErro = "";
    let  erroValidacao =  {"nota":"","comentario":""};
    let  avisoErro =  {"nota":"","comentario":""};
    if(erros) {
        erros.errors.forEach(function(erro) {
            if (erro.path == "nota") {
                erroValidacao.nota = "erro",
                avisoErro.nota = erro.msg
                msgErro += `* ${erro.msg} <br>`;
            }
            if (erro.path == "comentario") {
                erroValidacao.comentario = "erro",
                avisoErro.comentario = erro.msg
                msgErro += `* ${erro.msg} <br>`;
            }
        })
       if(msgErro != ""){
        %>
        <script>
                let msgErro ="<%= msgErro %>"
                notify("Erro(s) no preenchimento","Verifique o(s) campo(s) <br>  " + msgErro.replace(/&lt;/g,"<").replace(/&gt;/g,">"),
                 "error", "center", 5000)                        
            </script>
        <%
        }
    }
    if (dadosNotificacao) { %>
        <script>
                notify("<%= dadosNotificacao.titulo%>","<%= dadosNotificacao.mensagem%>", "<%= dadosNotificacao.tipo%>", "center")
                if("<%= dadosNotificacao.tipo %>" == "success"){
                    setTimeout(function(){window.location="/sair"}, 3000)
                }                        
        </script>
    <% } %>
    <%- include('../partials/navbar'); %>

    <section class="perfil-container">
        <section class="perfil" id="pepe">
            <!-- <span class="logo-info"> -->
            <figure>
                <img src="<%= valores.img_perfil_banco || valores.img_perfil_pasta || '../imagem/escola-padrao.png' %>" alt="logo da escola" class="ft-perfil">
            </figure>
            <section class="info">
                <h1 class="nome-escola"><%= valores.name %></h1>
                <aside class="niveis">
                    <% (valores.tipos_ensino || []).forEach(tipo => { %>
                        <h5 class="escolaridade <%= tipo.trim().toUpperCase().substring(0, 3) %> <%= tiposclassseCss[tipo.trim()] || '' %>"><%= tipo %></h5>
                    <% }) %>
                </aside>
                   <section class="descricao">
                    <p class="localidade">
  <%= valores.logradouro %>, <%= valores.numero %>
  <% if (valores.bairro) { %> - <%= valores.bairro %> <% } %>
  <br>
  <%= valores.cidade %> - <%= valores.estado %>
  <br> <br>
  <!-- CEP: <%= cep %> -->
</p>
                    <p class="instituicao "><%= valores.redes %></p>
                    <p class="ingresso"><%= valores.ingresso || '' %></p>
                    <% if(autenticado && autenticado.autenticado){ %> <button class="edit" type="button"><a class="edit" href="/editar-escola" target="">Editar perfil</a></button> <% } %>
                    </section>
            </section>
        </section>
        <section class="slider">

            <section class="slides">
                <!--radio butoons-->
                <input type="radio" name="radio-btn" id="radio1" checked>
                <input type="radio" name="radio-btn" id="radio2">
                <input type="radio" name="radio-btn" id="radio3">
                <input type="radio" name="radio-btn" id="radio4">

                <!--imagem dos slide-->

                <section class="slide first">
                    <img src="imagem/primeira-carrossel.jpeg" alt="imagem-1">
                </section>
                <section class="slide">
                    <img src="imagem/segunda-carrossel.jpg" alt="imagem-2">
                </section>
                <section class="slide">
                    <img src="imagem/terceira.jpg" alt="imagem-3">
                </section>
                <section class="slide">
                    <img src="https://crechesonhoencantado.com.br/wp-content/uploads/2019/10/MG_2532.jpg" alt="imagem-4">
                </section>

                <section class="navegacao-auto">
                    <section class="auto-btn1"></section>
                    <section class="auto-btn2"></section>
                    <section class="auto-btn3"></section>
                    <section class="auto-btn4"></section>
                </section>

            </section>

            <!-- Left and right controls -->
            <a class="prev" onclick="changeSlide(-1)">&#10094;</a>
            <a class="next" onclick="changeSlide(1)">&#10095;</a>

            <section class="manual-navegacao">
                <label for="radio1" class="manual-btn"></label>
                <label for="radio2" class="manual-btn"></label>
                <label for="radio3" class="manual-btn"></label>
                <label for="radio4" class="manual-btn"></label>
            </section>
        </section>
    </section>
    <hr>
    <section class="ultimo_tamanho">
    <section class="informacao">
        <h1 class="titulo-contato">Sobre a Escola</h1>
    <article class="descricao2">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <%= valores.sobre || 'Este perfil ainda não escreveu nada sobre sua instituição.' %>
    </article>
        <h1 class="titulo-contato">Sobre o Ensino</h1>
        <ul class="listinha">
            <%= valores.sobre_ensino || 'Este perfil ainda não escreveu nada sobre seu ensino.' %>
        </ul>
        <h1 class="titulo-contato">Sobre a Estrutura</h1>
        <ul class="listinha">
            <%= valores.sobre_estrutura || 'Este perfil ainda não escreveu nada sobre sua estrutura.' %>

        </ul>
    </section>
    <p class="linha-vertical"></p>
<section class="lado">
    <section class="contatos">
        <h1 class="titulo-contato">Contato</h1>
        <section class="formas-contato">
            <figure><a href="<%=valores.instagram%> || https://www.instagram.com/" target="_blank"><img src="imagem/i1.svg" alt="Instagram" class="social-media" id="insta"></a></figure>
            <figure><a href="<%=valores.whatsapp%> || https://www.whatsapp.com" target="_blank"><img src="imagem/w1.svg" alt="WhattsApp" class="social-media" id="what"></a></figure>
            <figure><a href="<%=valores.whatsapp%> ||https://www.facebook.com" target="_blank"><img src="imagem/f1.svg" alt="Facebook" class="social-media" id="face"></a></figure>
            <figure><a href="tel:<%=valores.telefone%> || '' " target="_blank"><img src="imagem/t1.svg"class="social-media" alt="Telefone" id="telefone"></a></figure>
            <figure><a href="mailto:<%=valores.email%> || '' " target="_blank"><img src="imagem/e1.svg"class="social-media" alt="Email" id="email"></a></figure>
        </section>
    </section>
    <section class="contatos">
        <h1 class="titulo-contato">Acessibilidade</h1>
        <section class="formas-contato">
            <figure><a href="#" target="_blank"><img src="imagem/bengala.png" alt="Instagram" class="social-media" id="#"></a></figure>
            <figure><a href="#" target="_blank"><img src="imagem/lingua-de-sinais.png" alt="WhattsApp" class="social-media" id="#"></a></figure>
            <figure><a href="#" target="_blank"><img src="imagem/acessibilidade-cadeira-de-rodas.png" alt="Facebook" class="social-media" id= "#"></a></figure>
        </section>
    </section>
    <section class="contatos">
    <h1 class="titulo-contato">Ingresso</h1>
        <section class="config-ingresso">
    <article class="tipos-de-ingresso">
        <p><%= valores.ingresso || 'Este perfil ainda não escreveu nada sobre seu ingresso.' %></p>
        </section>
    </section>
    </section>
</section>

    <script src="script.js"></script>
    <hr id="div">
    <section class="aval"><br>
        <h1>Avaliações</h1>
        <p class="avalinfo">Compartilhe suas impressões e experiência sobre essa instituição</p>
        <form action="/avaliar" method="post">
        <input type="hidden" name="id_usuario" value="<%= autenticado && autenticado.id_usuario || '' %>">
        <input type="hidden" name="id_escola" value="<%= valores.id_escola %>">
        <input type="hidden" name="id_usuario_escola" value="<%= valores.id_usuario %>">
        <span class="centro">
        <section class="rating"> 
            <input type="radio" value="5" name="rating" id="rating-5">
            <label for="rating-5"></label>
            <input type="radio" value="4" name="rating" id="rating-4">
            <label for="rating-4"></label>
            <input type="radio" value="3" name="rating" id="rating-3">
            <label for="rating-3"></label>
            <input type="radio"value="2" name="rating" id="rating-2">
            <label for="rating-2"></label>
            <input type="radio" value="1" name="rating" id="rating-1">
            <label for="rating-1"></label>
        </section>
        <section class="ratetext">
            <textarea name="ratetext" id="ratetext" maxlength="352" placeholder="Escreva aqui sua opinião"></textarea>
            <span id="caracteres">O número de caracteres foi atingido!</span>
        </section>
        <section> <button type="submit" h id="enviar">Enviar</button></section></span></form>

        <section id="avaliacoes">
            <hr>
            <section id="caixa_comentarios">
                <% avaliacoes.forEach(aval => { %>
                <article id="comentario">
                    <section id="info_usuario_comentario">
                        <img src="https://cdn-icons-png.flaticon.com/512/219/219969.png" id="foto_comentario">
                        <h3><%= aval.nome_usuario || "Visitante" %></h3>
                    </section>
                    <p>• <%= aval.data_formatada %></p>
                    <section id="texto">
                        <%= aval.comentario %> <img src="imagem/<%= aval.nota %>estrelas.webp" id="estrelas">
                    </section>
                </article>
                <% }) %>
            </section>
        </section>

    </section>
<%- include('../partials/footer'); %>
<script>
    const textarea = document.getElementById('ratetext');
    const warning = document.getElementById('caracteres');

    textarea.addEventListener('input', () => {
        let caracteres = textarea.value.length;

        if (caracteres >= 352) {
            warning.style.display = 'block';
        } else {
            warning.style.display = 'none';
        }
    });

    let counter = 1;
    setInterval(function(){
      document.getElementById('radio' + counter).checked = true;
      counter++;
      if(counter > 4){
        counter = 1;
      }
    }, 5000);

    function changeSlide(n) {
      counter += n;
      if (counter > 4) counter = 1;
      if (counter < 1) counter = 4;
      document.getElementById('radio' + counter).checked = true;
    }

    function updateSocialMediaImages() {
        const isDark = document.body.classList.contains('tema-escuro');
        const socialImages = document.querySelectorAll('.social-media');
        socialImages.forEach(img => {
            let src = img.src;
            if (isDark) {
                img.src = src.replace('1.svg', '2.svg');
            } else {
                img.src = src.replace('2.svg', '1.svg');
            }
        });
    }
    updateSocialMediaImages();
    const observer = new MutationObserver(updateSocialMediaImages);
    observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });

</script>
</body>
</html>
