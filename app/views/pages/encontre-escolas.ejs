
<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/encontre-escola.css">
    <link rel="icon" type="image/png" href="/imagem/favicon.png">
    <link rel="stylesheet" href="css/vizu.css">
    <link rel="stylesheet" href="css/aval.css">

    <title> Encontre Escolas! </title>
</head>

<body>
    <%- include('../partials/navbar'); %>

    <%- include('../partials/search-bar-new'); %>
    <script src="js/limitacoes-de-texto.js"></script>
<!-- Barra de pesquisa-->

    <!-- <section class="search-bar">
        <input type="text" id="nome-escola-search" name="nome-escola-search" placeholder="Nome da Escola" class="A">
        <select name="UF" id="regiao-search" class="A">
            <ul>
                <option value="regiao"> Região </option>
                <option value="RNO"> Região Norte</option>
                <option value="RND"> Região Nordeste </option>
                <option value="RCE"> Região Centro-Oeste</option>
                <option value="RSD"> Região Sudeste</option>
                <option value="RSU"> Região Sul</option>

            </ul>
            <input type="text" id="cidade-search" name="cidade-search" placeholder="Cidade" class="A">
        </select>
    </section> -->

    <%
        const tiposclassseCss = {
            'Educação Infantil': 'EI',
            'Ensino Fundamental I': 'EFI',
            'Ensino Fundamental II': 'EFII',
            'Ensino Fundamental': 'EFI',
            'Ensino Médio': 'EM',
            'Educação Integrada': 'EINT',
            'Cursos Técnicos': 'TEC',
            'Cursos Extracurriculares': 'CSO'
        }
        
    %>

    <% if (escolas && escolas.length > 0) { %>
        <% escolas.forEach(escola => { %>
            <section class="short-prof" id="eded">
                <figure><img src="<%= escola.img_perfil_pasta || '../imagem/escola-padrao.png' %>" alt="logo da escola" class="logo"></figure>
                <section class="info">
                    <h1 class="nome-escola"> <%= escola.nome_escola %> </h1>

                    <aside class="niveis">
                        <% if (escola.tipo_ensino) { %>
                            <% const tipos = escola.tipo_ensino.split(','); %>
                            <% tipos.forEach(tipo => { %>
                                <h5 class="escolaridade <%= tipo.trim().toUpperCase().substring(0, 3) %> <%= tiposclassseCss[tipo.trim()] || '' %>"><%= tipo.trim() %></h5>
                            <% }); %>
                        <% } %>
                    </aside>

                    <section class="inf">
                        <p class="localidade" data-cep="<%= escola.cep %> ">Carregando endereço...</p>
                        <p class="instituicao"><%= escola.rede || 'Não informado' %></p>
                    </section>
                    <p class="rating-stars">
                        <% for (let i = 1; i <= 5; i++) { %>
                            <span class="star <%= i <= Math.round(escola.media_avaliacao || 0) ? 'filled' : '' %>"></span>
                        <% } %>

                    </p>

                    <button type="submit" class="buttao"> <a href="/perfil-escola?id=<%= escola.id_usuario %>">VER PERFIL</a></button>
                </section>
            </section>
        <% }); %>
    <% } else { %>
        <p>Nenhuma escola encontrada.</p>
    <% } %>
    
    

    <section>
    <% if(paginador){ %>
    <aside class="paginador">
    <ul>
        <% for(var i=1; i <= paginador.totPaginas; i++){ %>
            <% if(paginador.paginaAtual == i){ %>
                <li>
                    <a href="?pagina=<%= i %>" class="atual"><%= i %></a>
                </li>
            <% } else { %>
                <li>
                    <a href="?pagina=<%= i %>"><%= i %></a>
                </li>
            <% } %>
        <% } %>
    </ul>
    </aside>
<% } %>
 </section>

    <section id="blank"> <br><br><br><br><br><br><br><br></section>


    <script>
        const ingressos = document.querySelectorAll('.ingresso');
    
        ingressos.forEach(ingresso => {
            const text = ingresso.textContent;
            const truncatedText = text.length > 30 ? text.slice(0, 30) + '...' : text;
            ingresso.textContent = truncatedText;
        });
    </script>
    

</body>
<%- include('../partials/footer'); %>
</html>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const localidadeElements = document.querySelectorAll('.localidade');

    localidadeElements.forEach(async (el) => {
        const cep = el.getAttribute('data-cep');
        if (cep) {
            try {
                const response = await fetch(`https://viacep.com.br/ws/${cep.replace(/\D/g, '')}/json/`);
                const data = await response.json();
                if (!data.erro) {
                    el.textContent = `${data.logradouro || ''}, ${data.bairro || ''} - ${data.localidade}/${data.uf}`;
                } else {
                    el.textContent = "Endereço não encontrado";
                }
            } catch (error) {
                console.error("Erro ao buscar CEP:", error);
                el.textContent = "Falha ao carregar endereço";
            }
        } else {
            el.textContent = "CEP indisponível";
        }
    });
});
</script>
