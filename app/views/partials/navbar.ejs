    <link rel="icon" type="image/png" href="../imagem/favicon.png">
<link rel="stylesheet" href="/css/menu.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-notify@0.5.5/dist/simple-notify.min.css" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/simple-notify@0.5.5/dist/simple-notify.min.js"></script>
<script>
    if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.remove('tema-claro');
        document.body.classList.add('tema-escuro');
    }
</script>

<section class="navbar">
    <header>
        <nav role="navigation">
        <section id="menuToggle">
            <input id="check" type="checkbox">
                <span></span>
                <span></span>
                <span></span>

                <ul id="menu">
    <a href="/"><img src="/imagem/logo.png" alt="" id="logo"></a>
    <a href="/"><li id="inicio">Ínicio</li></a>
    <details class="master">
        <summary><li id="lista-summary">
            <a class="dropdown-arrow" id="encontre" href="/encontre-escolas">Encontre Escolas</a>
            <ul class="submenu">
                <li><a href="/edu-infantil">Educação Infantil</a></li>
                <li><a href="/ensino-fund1">Ensino Fundamental I</a></li>
                <li><a href="/ensino-fund2">Ensino Fundamental II</a></li>
                <li><a href="/ensino-medio">Ensino Médio</a></li>
                <li><a href="/cursos-tecnicos">Cursos Técnicos</a></li>
                <li><a href="/cursos">Cursos Extracurriculares</a></li>
                <li><a href="/mais-filtros">Mais Filtros</a></li>
            </ul>
        </li></summary>
    </details>
    <a href="/contato"><li>Contato</li></a>
    <section class="aside">
        <% if(autenticado && autenticado.autenticado){ %>
            <% if( autenticado && autenticado.tipo === "E" ) { %>
                <a href="/perfil-escola"><li><img src="<%= autenticado.img_perfil_banco || autenticado.img_perfil_pasta || '../imagem/escola-padrao.png' %>" id="perfil-foto-navbar" alt="Foto de Perfil"></li></a>
            <% } else if(autenticado && (autenticado.tipo === "C" || autenticado.tipo === "A")){%>
                <a href="/perfil1"><li><img src="<%= autenticado.img_perfil_banco || autenticado.img_perfil_pasta || 'https://cdn-icons-png.flaticon.com/512/219/219969.png' %>" id="perfil-foto-navbar" alt="Foto de Perfil do Usuário"></li></a>
            <%}%>
            <% if( autenticado && autenticado.tipo === "E" ) { %>
<details class="notificacao-master">
  <summary id="notificacao-summary">
    <li class="notificacao-botao">
      <img src="../imagem/bell.svg" alt="Notificações" id="bell-icon">
      <span id="notificacao-count">0</span>
    </li>
  </summary>

  <ul id="notificacao-list" class="notificacao-submenu">
    <!-- Notificações serão inseridas dinamicamente -->
    <li class="notificacao-vazia">Sem notificações novas</li>
  </ul>
</details>
<% } %>

            <a href="/sair"><li>Sair</li></a>

        <% } else { %>
            <a href="/login"><li>Login</li></a>
            <li><button><a href="/cadastro-escola" id="cadastro">Cadastre sua Escola</a></button></li>
        <% } %>
        <button onclick="toggleTheme()" class="sun" id="tema"></button>
    </section>
</ul>
            </section>
        </nav>
    </header>
</section>

<% if(autenticado && autenticado.tipo === "A") { %>
    <%- include('navbar-adm'); %>
<% } %>

<script src="/js/theme-toggle.js"></script>
<script>
    async function loadNotificacoes() {
        try {
            const response = await fetch('/notificacoes');
            const notificacoes = await response.json();
            const list = document.getElementById('notificacao-list');
            list.innerHTML = '';
            if (notificacoes.length === 0) {
                list.innerHTML = '<li>Nenhuma notificação</li>';
            } else {
                notificacoes.forEach(notif => {
                    const li = document.createElement('li');
                    li.textContent = notif.mensagem;
                    li.classList.add(notif.lida ? 'lida' : 'nao-lida');
                    list.appendChild(li);
                });
            }
            updateCount(notificacoes.filter(n => !n.lida).length);
        } catch (error) {
            console.error('Erro ao carregar notificações:', error);
        }
    }

    async function markAllAsRead() {
        try {
            const response = await fetch('/notificacoes/marcar-todas-lidas', {
                method: 'POST'
            });
            if (response.ok) {
                updateCount(0);
                const list = document.getElementById('notificacao-list');
                if (list.children.length === 0) {
                    list.innerHTML = '<li>Sem novas notificações</li>';
                }
                // Mark all list items as read
                Array.from(list.children).forEach(li => {
                    li.classList.remove('nao-lida');
                    li.classList.add('lida');
                });
            }
        } catch (error) {
            console.error('Erro ao marcar todas as notificações como lidas:', error);
        }
    }

    function updateCount(count) {
        const countSpan = document.getElementById('notificacao-count');
        if (count > 0) {
            countSpan.textContent = count;
            countSpan.style.display = 'inline';
        } else {
            countSpan.style.display = 'none';
        }
    }

    // Load count on page load
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const response = await fetch('/notificacoes');
            const notificacoes = await response.json();
            updateCount(notificacoes.filter(n => !n.lida).length);
        } catch (error) {
            console.error('Erro ao carregar contagem de notificações:', error);
        }

        // Load notifications when details is opened
        const details = document.querySelector('#notificacao-summary').parentElement;
        details.addEventListener('toggle', () => {
            if (details.open) {
                loadNotificacoes();
                markAllAsRead();
            }
        });
    });
</script>
